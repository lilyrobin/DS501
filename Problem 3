#code for problem 3

#scatter plot of men vs women, mean rating
#mean_rating = data.pivot_table('rating', rows='title',cols='gender', aggfunc='mean')
plt.scatter(mean_rating.F, mean_rating.M)


#men vs women average rating, ratings count>200
dat200 = ratings_by_title.index[ratings_by_title >= 200]
mean_rating_1 = mean_rating.ix[dat200]
plt.scatter(mean_rating_1.F, mean_rating_1.M)

#correlation cofficient
print mean_rating.corr()

#* Conjecture under what circumstances the rating given by one gender can be used to predict the rating given by the other gender.
 #   * For example, are men and women more similar when they are younger or older?
    
#idea one: genders similarity by age bracket

#kids
print ("\n kids")
mean_rating_kids =kids.pivot_table('rating',rows='title',cols='gender',aggfunc='mean')
plt.scatter(mean_rating_kids.F, mean_rating_kids.M)
print mean_rating_kids.corr()

print ("\n teens")
mean_rating_teens =teens.pivot_table('rating',rows='title',cols='gender',aggfunc='mean')
#plt.scatter(mean_rating_teens.F, mean_rating_teens.M)
print mean_rating_teens.corr()

print ("\n adults")
mean_rating_adult =adults.pivot_table('rating',rows='title',cols='gender',aggfunc='mean')
#plt.scatter(mean_rating_adult.F, mean_rating_adult.M)
print mean_rating_adult.corr()

print ("\n middle age")
mean_rating_middle =middle_age_data.pivot_table('rating',rows='title',cols='gender',aggfunc='mean')
#plt.scatter(mean_rating_middle.F, mean_rating_middle.M)
print mean_rating_middle.corr()

#print ("\n elderly")
#mean_rating_old =old.pivot_table('rating',rows='title',cols='gender',aggfunc='mean')
#plt.scatter(mean_rating_old.F, mean_rating_old.M)
#print mean_rating_old.corr()


#idea two: 

#more exploration of men vs women
#would be hardest to predict for movies with the greatest difference between them
#so what has the greatest difference between them?

#inspiration from http://www.gregreda.com/2013/10/26/using-pandas-on-the-movielens-dataset/

most_50 = data.groupby('movie_id').size().order(ascending=False)[:50]
pivoted = data.pivot_table(rows=['movie_id', 'title'],
                           cols=['gender'],
                           values='rating',
                           fill_value=0)
#print pivoted.head()
pivoted['diff'] = pivoted.M - pivoted.F
pivoted.reset_index('movie_id', inplace=True)

disagreements = pivoted[pivoted.movie_id.isin(most_50.index)]['diff']
disagreements.order().plot(kind='barh', figsize=[9, 15])
plt.title('Male vs. Female Avg. Ratings\n(Difference > 0 = Favored by Men)')
plt.ylabel('Title')
plt.xlabel('Average Rating Difference');
