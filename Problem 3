#code for problem 3
#default color is blue for men, colorful points stand for women so that it can better see the distribution
#of those points between men and women. 

#scatter plot of men vs women, their mean rating for every movie
# with the increase of men's mean rating of movies, the mean rating of women is also increased. According to
#the scatter plot, we can argue that there is a linear corelation between men's rating and women's rating.

mean_rating = data.pivot_table('rating', rows='title',cols='gender', aggfunc='mean')
plt.scatter(mean_rating.M,mean_rating.F,c=mean_rating.F)


#men vs women average rating, ratings count>200
#we can see in the scatter plot that men's average rating which is over 200 times is definitely linearly associated with
#women's average rating. 
dat200 = ratings_by_title.index[ratings_by_title >= 200]
mean_rating_1 = mean_rating.ix[dat200]
plt.scatter(mean_rating_1.F, mean_rating_1.M,c=mean_rating_1.F)

#correlation cofficient between men and women is 0.76319
#correlation cofficient r, its range from -1 to 1, if abs(r) is larger or near 1, the degree of linear correlation
#is higher. so our correlation cofficient r=0.76319 which is larger than 1, it can prove this is a positive linear 
#correlation between that two datasets. Meanwhile 0.5<|r|<0.8, we can say they are moderate corelation. 
print mean_rating.corr()

#* Conjecture under what circumstances the rating given by one gender can be used to predict the rating given by the other gender.
 #   * For example, are men and women more similar when they are younger or older?
 
#idea one: genders similarity by age bracket

#kids
#r = 0.3478, 0.3<|r|>0.5 which is low correlation. 
print ("\n kids")
mean_rating_kids =kids.pivot_table('rating',rows='title',cols='gender',aggfunc='mean')
plt.scatter(mean_rating_kids.F, mean_rating_kids.M)
print mean_rating_kids.corr()

#teenager
#r= 0.5756, 0.5<|r|>0.8, which is moderate correlation.
print ("\n teens")
mean_rating_teens =teens.pivot_table('rating',rows='title',cols='gender',aggfunc='mean')
plt.scatter(mean_rating_teens.F, mean_rating_teens.M,c=mean_rating_teens.F)
print mean_rating_teens.corr()

#adult
#r=0.6862,0.5<|r|>0.8, which is moderate correlation.
print ("\n adults")
mean_rating_adult =adults.pivot_table('rating',rows='title',cols='gender',aggfunc='mean')
plt.scatter(mean_rating_adult.F, mean_rating_adult.M,c=mean_rating_adult.F)
print mean_rating_adult.corr()

#middle age
#r= 0.6538,0.5<|r|>0.8, which is also moderate correlation.
print ("\n middle age")
mean_rating_middle =middle_age_data.pivot_table('rating',rows='title',cols='gender',aggfunc='mean')
plt.scatter(mean_rating_middle.F, mean_rating_middle.M,c=mean_rating_middle.F)
print mean_rating_middle.corr()

#Q:Are men and women more similar when they are younger or older
#Analysis:firstly, we have to mention correlation coefficient r. The bigger r is, the degree of correlation is higher
which means in this situation people tend to do similar thing like similar rating. Unfortunately, what had happened
is not what we expected. r is totally different among different group of people. you can see the correlation coeffienct r that is collected
by us, as age of people increased, from children to middle aged people, r has been increased constantly. To sum up , there exist a tendancy 
that people rate similarly with the increase of their age.


#idea two: 

#more exploration of men vs women
#would be hardest to predict for movies with the greatest difference between them
#so what has the greatest difference between them?

#inspiration from http://www.gregreda.com/2013/10/26/using-pandas-on-the-movielens-dataset/

most_50 = data.groupby('movie_id').size().order(ascending=False)[:50]
pivoted = data.pivot_table(rows=['movie_id', 'title'],
                           cols=['gender'],
                           values='rating',
                           fill_value=0)
#print pivoted.head()
pivoted['diff'] = pivoted.M - pivoted.F
pivoted.reset_index('movie_id', inplace=True)

disagreements = pivoted[pivoted.movie_id.isin(most_50.index)]['diff']
disagreements.order().plot(kind='barh', figsize=[9, 15])
plt.title('Male vs. Female Avg. Ratings\n(Difference > 0 = Favored by Men)')
plt.ylabel('Title')
plt.xlabel('Average Rating Difference');
